# 作業日誌

## 2024-01-23

- [ ] SWエディタの表示幅バグ修正
- [ ] SWエディタの保存バグ修正
- [x] Pathをすべて配列で持たせる
- [x] シミュレータの表示UIモックアップ

### めも

- オブジェクトの ○○-able を一目で確認できるUIにする必要がある
  - カーソルで提示する
  - Click と Move

## 2023-12-30

### やる

- [ ] エラーメッセージのシステムを作る
- [ ] インスタンスのエラー
- [ ] ワイヤのエラー（ポートの不在、型、幅、向き）
- [ ] ポートのエラー（ポートの重複、向き）

## 2023-12-23

### やる

- [ ] パッケージのダウンロードを実装する

### めも

- レジストリを書いた
- routerを作った
- recoilの思想に則ったrouteを作る
  - route=./editor?project=/path/to/project からrecoilの依存関係グラフでprojectのロードを発火する
- file path の扱いが謎なので直す
  - node.jsのwindowsとunixでの挙動の違いを理解する必要がある

## 2023-12-20

### やる

- [x] 経由点の範囲選択
- [x] 経由点の単体選択
- [x] 経由点の作成
- [x] パッケージリポジトリを作る
- [ ] パッケージのダウンロードを実装する

### めも

- よく考えたら、ワイヤを単体で移動することはできない
  - 経由点を移動することはできる
  - ワイヤの位置は接続されたものの位置で決まるので
- ワイヤの両端のオブジェクトが選択された場合に
- では、ワイヤの削除はどうするか
  - waypoint以外の場所をクリックしたらワイヤを選択できる
- drawioは、ワイヤを選択すると、waypointが選択できるようになる
  - これはたぶんよくない
  - 周りのワイヤの形を含めて選択して移動したいことがけっこうあるので
- selectがenumで実装されているあたりからクソコードの気配がするので直す
  - なぜ直和型で混ぜる必要があるんですか？？？
- 四角形の実装をどうにかする
- keyはオブジェクトを一意に指定するための必要十分な情報を持つ
- storeとfacadeに分離する
  - storeにはstateとactionを実装する
    - dagを意識する
  - store完全に依存関係のない複数のサブディレクトリに分解できる
    - ひとまずひとつで作った後に分解する
    - facadeで結合される
  - facadeはviewに渡す関数をまとめたhookを実装する
    - いままでactionsと呼んでいた部分とstate/viewと呼んでいた部分をまとめる
  - routeはviewの状態を決めるstateでロジックとは分離する
  - view中のimportはfacadeのみ
- 同じfacadeでグラフビューとリストビューのコンポーネントを描画できるのが良い設計な気がする
  - が、それはfacadeの思想に反する気もする
  - つまり、facadeはコンポーネントと結合する前線で、共通部分はstoreでくっつけておく？
- selectedの範囲を計算するものが必要
  - flipとpasteに必要
- Midpointの実装が汚いがしばし放置
- コピペ、けっこう難しいぞい
- ハードウェアへの割り当て未定状態のIOがあってもいいかもしれない
- IOもパッケージにしてInstanceとIOPortを統一したい
  - パッケージにtraitを割り当て、ボードに制約を実装する
- ハードウェアの編集時にバリデーションはしない
  - 配線の向きなど
- 裏で回っているビルド側でエラーを吐く
  - ポートのリソース不足
- Assignフィールドを追加した
  - ハードウェアリソースの割り当てを意味する
    - ioなら、ポート番号名
    - irqなら、割り込み番号名
  - 名前空間の分離
    - ボードに存在するリソースと合致した名前が割り当てられていないと、verilog生成時にエラーを吐く

## 2023-12-19

### やる

- [x] 一覧表を改善する
- [x] 選択したオブジェクトを一覧表側でもハイライトする
- [x] Ctrlで選択を追加する
- [x] 経由点の表現方法を考える
- [ ] ワイヤの範囲選択を実装
- [ ] ワイヤの移動を実装

### めも

- コンポーネント名を、内部でstateを参照してるか、引数としてstateを参照してるかで分けたい
  - 純粋なviewはviewってつけるか
- 配線時に謎の経由点が作成されるのはなに？？？
  - 配線の表示との兼ね合いで、fsm.value.pathに開始点座標が書かれてしまっている
  - じきになおす
- オブジェクトを削除したときにワイヤが削除されてないやんけ
  - なおした
- あとは似たもの作るだけ～
- Undo/Redoボタンに無効状態を実装したいね
  - ボタンで発火した関数が非同期処理の場合、ボタンの表示にも反映させたい
- 開くときにエラーになるプロジェクトをどうにかしたい
  - パッケージが存在しない！など
- recoilの関数が走るたびにエラーが吐られるのどうにかしたい
- 線分と四角形の衝突判定めんどくさすぎ
- ワイヤ
  - ワイヤの経由点、今は絶対位置で表現している
  - 範囲選択で動かすとき
    - ワイヤの両端のオブジェクトを選択したら、ワイヤ全体を動かす
    - ワイヤ全体を掴まずに、一部の経由点だけ選択したら、経由点だけを動かす
  - 範囲選択のとき
    - ワイヤに少しでもカスったら選択してほしい
  - 問題は、オブジェクトの選択→アクションというフローに入れ込むのが難しい

## 2023-12-18

- wireの削除時に一瞬別のワイヤがハイライトされるのは、たぶんreactのkeyのせい
